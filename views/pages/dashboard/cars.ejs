<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/output.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss/dist/tailwind.min.css">
    <title>CarSell-dashboard-cars</title>

    <script src="/sweetalert/dist/sweetalert2.min.js"></script>
    <link rel="stylesheet" href="/sweetalert/dist/sweetalert2.min.css">

</head>

<body>

    <main class="w-full h-screen flex">
        <!-- Sidebar start -->
        <%- include('../../partials/sidebar') %>

            <div class="h-full w-full  bg-[#1f551a5e] flex flex-col ">
                <%- include('../../partials/dashboard_header') %>

                    <div class="px-8 w-full flex flex-col lg:flex-row h-screen py-4 overflow-y-auto">

                        <div class="bg-white h-full w-full rounded-lg overflow-y-auto">
                            <div class=" w-full flex flex-col justify-evenly h-full ">

                                <div class="flex relative px-10 w-full h-1/4 py-4 border-b-4 border-[#1a551a] justify-between items-end
                                ">

                                    <p class="text-xl font-bold ">Your cars</p>

                                    <button id="open-modal"
                                        class="px-6 py-2 font-medium tracking-wide text-white capitalize transition-colors duration-300 transform bg-[#1f551a] rounded-lg hover:bg-[#1f551a] focus:outline-none focus:ring focus:ring-[#1f551a5e] focus:ring-opacity-80">
                                        <span class="text-2xl">+</span>Add car
                                    </button>

                                </div>

                                <!-- table of cars start -->


                                <section class="container px-4 overflow-y-auto  h-2/3">

                                    <div class="flex flex-col mt-6">
                                        <div class="-mx-4 -my-2 overflow-x-hidden sm:-mx-6 lg:-mx-8">
                                            <div class="inline-block min-w-full py-2 align-middle md:px-6 lg:px-8">
                                                <div
                                                    class="overflow-hidden border border-gray-200 dark:border-gray-700 md:rounded-lg">
                                                    <table
                                                        class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                                        <thead class="bg-gray-50 dark:bg-gray-800">
                                                            <tr>
                                                                <th scope="col"
                                                                    class="py-3.5 px-4 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                                                    <div class="flex items-center gap-x-3">
                                                                        <span>ID</span>
                                                                    </div>
                                                                </th>
                                                                <th scope="col"
                                                                    class="py-3.5 px-4 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                                                    <div class="flex items-center gap-x-3">
                                                                        <span>Marque</span>
                                                                    </div>
                                                                </th>

                                                                <th scope="col"
                                                                    class="px-12 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                                                    <button class="flex items-center gap-x-2">
                                                                        <span>Couleur</span>


                                                                    </button>
                                                                </th>

                                                                <th scope="col"
                                                                    class="px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                                                    <button class="flex items-center gap-x-2">
                                                                        <span>Annee</span>
                                                                    </button>
                                                                </th>

                                                                <th scope="col"
                                                                    class="px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                                                    model</th>

                                                                <th scope="col"
                                                                    class="px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                                                    kilometrage</th>
                                                                <th scope="col"
                                                                    class="px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                                                    Action(s)</th>


                                                            </tr>
                                                        </thead>
                                                        <tbody
                                                            class="bg-white divide-y divide-gray-200 dark:divide-gray-700 dark:bg-gray-900">
                                                            <% for( let i=0; i < voitures.length; i++ ) { %>
                                                                <tr>
                                                                    <td
                                                                        class="px-4 py-4 text-sm font-medium text-gray-700 whitespace-nowrap">
                                                                        <div class="inline-flex items-center gap-x-3">

                                                                            <div class="flex items-center gap-x-2">
                                                                                <h2
                                                                                    class="font-medium text-gray-800 dark:text-white ">
                                                                                    <%= voitures[i].id_voiture %>
                                                                                </h2>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    <td
                                                                        class="px-4 py-4 text-sm font-medium text-gray-700 whitespace-nowrap">
                                                                        <div class="inline-flex items-center gap-x-3">

                                                                            <div class="flex items-center gap-x-2">
                                                                                <img class="object-cover w-10 h-10 rounded-full"
                                                                                    src="<%= url[0] %>/<%= voitures[i].photos %>"
                                                                                    alt="">
                                                                                <div>
                                                                                    <h2
                                                                                        class="font-medium text-gray-800 dark:text-white ">
                                                                                        <%= voitures[i].marque %>
                                                                                    </h2>

                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    <td
                                                                        class="px-12 py-4 text-sm font-medium text-gray-700 whitespace-nowrap">
                                                                        <div
                                                                            class="inline-flex items-center px-3 py-1 rounded-full gap-x-2 bg-emerald-100/60 dark:bg-gray-800">


                                                                            <h2>
                                                                                <%= voitures[i].couleur %>
                                                                            </h2>
                                                                        </div>
                                                                    </td>
                                                                    <td
                                                                        class="px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap">
                                                                        <%= voitures[i].annee %>
                                                                    </td>
                                                                    <td
                                                                        class="px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap">
                                                                        <%= voitures[i].modele %>
                                                                    </td>
                                                                    <td class="px-4 py-4 text-sm whitespace-nowrap">
                                                                        <div class="flex items-center gap-x-2">
                                                                            <h1
                                                                                class="font-medium text-gray-800 dark:text-white ">
                                                                                <%= voitures[i].kilometrage %>
                                                                            </h1>
                                                                        </div>
                                                                    </td>
                                                                    <td class="px-4 py-4 text-sm whitespace-nowrap">
                                                                        <div class="flex items-center gap-x-6">
                                                                            <a  href="" key-custom-attribute="<%= voitures[i].id_voiture %>"
                                                                                onclick="confirmDeletion(event)"
                                                                                class="text-gray-500 transition-colors duration-200 dark:hover:text-red-500 dark:text-gray-300 hover:text-red-500 focus:outline-none">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    fill="none" viewBox="0 0 24 24"
                                                                                    stroke-width="1.5"
                                                                                    stroke="currentColor"
                                                                                    class="w-5 h-5">
                                                                                    <path stroke-linecap="round"
                                                                                        stroke-linejoin="round"
                                                                                        d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                                                                </svg>
                                                                            </a>

                                                                            <button id="open-modal-modif"
                                                                                key-custom-attribute="<%= voitures[i].id_voiture %>"
                                                                                class="open-modal-modif text-gray-500 transition-colors duration-200 dark:hover:text-yellow-500 dark:text-gray-300 hover:text-yellow-500 focus:outline-none">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    fill="none" viewBox="0 0 24 24"
                                                                                    stroke-width="1.5"
                                                                                    stroke="currentColor"
                                                                                    class="w-5 h-5">
                                                                                    <path stroke-linecap="round"
                                                                                        stroke-linejoin="round"
                                                                                        d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                                                                                </svg>
                                                                            </button>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <% } %>

                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </section>

                                <div class="flex items-center justify-between my-6 mx-4">
                                    <a href="#"
                                        class="flex items-center px-5 py-2 text-sm text-gray-700 capitalize transition-colors duration-200 bg-white border rounded-md gap-x-2 hover:bg-gray-100 dark:bg-gray-900  dark:border-gray-700 dark:hover:bg-gray-800">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor" class="w-5 h-5 rtl:-scale-x-100">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M6.75 15.75L3 12m0 0l3.75-3.75M3 12h18" />
                                        </svg>

                                        <span>
                                            previous
                                        </span>
                                    </a>

                                    <div class="items-center hidden lg:flex gap-x-3">
                                        <a href="#"
                                            class="px-2 py-1 text-sm text-blue-500 rounded-md dark:bg-gray-800 bg-blue-100/60">1</a>
                                        <a href="#"
                                            class="px-2 py-1 text-sm text-gray-500 rounded-md dark:hover:bg-gray-800 dark:text-gray-300 hover:bg-gray-100">2</a>
                                        <a href="#"
                                            class="px-2 py-1 text-sm text-gray-500 rounded-md dark:hover:bg-gray-800 dark:text-gray-300 hover:bg-gray-100">3</a>
                                        <a href="#"
                                            class="px-2 py-1 text-sm text-gray-500 rounded-md dark:hover:bg-gray-800 dark:text-gray-300 hover:bg-gray-100">...</a>
                                        <a href="#"
                                            class="px-2 py-1 text-sm text-gray-500 rounded-md dark:hover:bg-gray-800 dark:text-gray-300 hover:bg-gray-100">12</a>
                                        <a href="#"
                                            class="px-2 py-1 text-sm text-gray-500 rounded-md dark:hover:bg-gray-800 dark:text-gray-300 hover:bg-gray-100">13</a>
                                        <a href="#"
                                            class="px-2 py-1 text-sm text-gray-500 rounded-md dark:hover:bg-gray-800 dark:text-gray-300 hover:bg-gray-100">14</a>
                                    </div>

                                    <a href="#"
                                        class="flex items-center px-5 py-2 text-sm text-gray-700 capitalize transition-colors duration-200 bg-white border rounded-md gap-x-2 hover:bg-gray-100 dark:bg-gray-900  dark:border-gray-700 dark:hover:bg-gray-800">
                                        <span>
                                            Next
                                        </span>

                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor" class="w-5 h-5 rtl:-scale-x-100">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M17.25 8.25L21 12m0 0l-3.75 3.75M21 12H3" />
                                        </svg>
                                    </a>
                                </div>

                            </div>
                        </div>
                    </div>


                    <!-- Modal to add a car -->




                    <div id="modal" class="modal fixed w-full h-full top-0 left-0 flex items-center justify-center">
                        <div id="modal-overlay" class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50">
                        </div>

                        <div id="modal-container"
                            class="modal-container bg-white w-11/12 md:max-w-xl mx-auto rounded shadow-lg z-50 overflow-y-auto">

                            <button onclick="toggleModal()" id="close-modal"
                                class="modal-close absolute top-0 right-0 cursor-pointer flex flex-col items-center mt-4 mr-4 text-sm z-50 bg-[#1f551a] py-1 px-2 rounded-md">
                                <span class="text-xl text-[#fff]">X</span>
                            </button>

                            <!-- Add modal content here -->
                            <div class="modal-content py-4 text-left px-6">
                                <div class="flex justify-between items-center pb-3">
                                    <p class="text-2xl font-bold">Add a car</p>
                                    <div class="modal-close cursor-pointer z-50">
                                        <svg class="fill-current text-black" xmlns="http://www.w3.org/2000/svg"
                                            width="18" height="18" viewBox="0 0 18 18">
                                            <path d="M1.39 1.393l15.243 15.243m0-15.243L1.393 16.636"></path>
                                        </svg>
                                    </div>
                                </div>
                                <section class="max-w-6xl p-6 mx-auto bg-white rounded-md shadow-md dark:bg-gray-800">

                                    <form id="form" method="post" action="" enctype="multipart/form-data">
                                        <div class="grid grid-cols-1 gap-6 mt-4 sm:grid-cols-2">
                                            <div>
                                                <label class="text-gray-700 " for="marque">Marque</label>
                                                <input id="marque" type="text" name="marque" value=""
                                                    class="block w-full px-4 py-2 mt-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-[#1f551a] focus:ring-[#1f551a] focus:ring-opacity-40 dark:focus:border-[#1f551a] focus:outline-none focus:ring">
                                            </div>

                                            <div>
                                                <label class="text-gray-700 " for="couleur">Couleur</label>
                                                <input id="couleur" type="text" name="couleur" value=""
                                                    class="block w-full px-4 py-2 mt-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-[#1f551a] focus:ring-[#1f551a] focus:ring-opacity-40 dark:focus:border-[#1f551a] focus:outline-none focus:ring">
                                            </div>

                                            <div>
                                                <label class="text-gray-700 " for="annee">Année</label>
                                                <input id="annee" type="number" name="annee" value=""
                                                    class="block w-full px-4 py-2 mt-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-[#1f551a] focus:ring-[#1f551a] focus:ring-opacity-40 dark:focus:border-[#1f551a] focus:outline-none focus:ring">
                                            </div>

                                            <div>
                                                <label class="text-gray-700 " for="modele">Modele</label>
                                                <input id="modele" type="text" name="modele" value=""
                                                    class="block w-full px-4 py-2 mt-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-[#1f551a] focus:ring-[#1f551a] focus:ring-opacity-40 dark:focus:border-[#1f551a] focus:outline-none focus:ring">
                                            </div>

                                            <div>
                                                <label class="text-gray-700 " for="kilometrage">Kilometrage</label>
                                                <input id="kilometrage" type="number" name="kilometrage" value=""
                                                    class="block w-full px-4 py-2 mt-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-[#1f551a] focus:ring-[#1f551a] focus:ring-opacity-40 dark:focus:border-[#1f551a] focus:outline-none focus:ring">
                                            </div>


                                            <div>
                                                <label for="image"
                                                    class="block text-sm text-gray-500 dark:text-gray-300">Image</label>

                                                <input type="file"
                                                    class="block w-full px-3 py-2 mt-2 text-sm text-gray-600 bg-white border border-gray-200 rounded-lg file:bg-gray-200 file:text-gray-700 file:text-sm file:px-4 file:py-1 file:border-none file:rounded-full dark:file:bg-gray-800 dark:file:text-gray-200 dark:text-gray-300 placeholder-gray-400/70 dark:placeholder-gray-500 focus:border-[#1f551a] focus:outline-none focus:ring focus:ring-[#1f551a] focus:ring-opacity-40 dark:border-gray-600 dark:bg-gray-900 dark:focus:border-[#1f551a]"
                                                    name="photos" />
                                            </div>
                                        </div>

                                        <div class="flex justify-between mt-6">
                                            <button type="submit" id="btn-form"
                                                class="inline-flex items-center justify-center w-full h-12 px-4 font-medium tracking-wide text-white transition duration-200 rounded shadow-md bg-[#1f551a] hover:bg-[#1f551afb] hover:shadow-lg focus:shadow-outline focus:outline-none">Save</button>
                                            <button type="button" id="cancel-modal"
                                                class="inline-flex items-center justify-center w-full h-12 px-4 ml-2 font-medium tracking-wide text-white transition duration-200 rounded shadow-md bg-[#551a1a] hover:bg-[#551a1afb] hover:shadow-lg focus:shadow-outline focus:outline-none">Cancel</button>

                                        </div>
                                    </form>
                                </section>
                            </div>
                        </div>
                    </div>
            </div>

    </main>

    <script>
        /* 
        * -----------------------------------------------------
        *|Début des scripts concernant la modale de suppréssion|
        * -----------------------------------------------------
        */
        function confirmDeletion(event) {
            event.preventDefault();

            Swal.fire({
                title: "Delete Alert",
                text: "Are you really sure you want to delete this car ? Once this action has been confirmed, the car will be permanently deleted.",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#1f551a",
                cancelButtonColor: "#d33",
                confirmButtonText: "I'm sure",
                cancelButtonText: "I'm not sure",
                customClass: {
                    confirmButton: "btn btn-primary",
                    cancelButton: "btn btn-danger",
                    popup: "my-popup-class",
                    content: "my-content-class",
                },
            }).then((result) => {
                if (result.value) {
                    window.location.href = "/voitures/delete/"+event.target.parentNode.getAttribute("key-custom-attribute")
                    // console.log(event.target.parentNode)
                    console.log("Action confirmée");
                } else {
                    console.log("Action annulée");
                }
            });
        }

        /* 
        * ---------------------------------------------------
        *| Début des scripts concernant les modales d'ajout et d'update |
        * ---------------------------------------------------
        **
        */
        const openModal = document.getElementById("open-modal");

        // Update modal
        const openModal2 = document.querySelectorAll(".open-modal-modif");

        const modal = document.getElementById("modal");
        const closeModal = document.querySelectorAll(".modal-close");
        const modalOverlay = document.getElementById("modal-overlay");
        const modalContainer = document.getElementById("modal-container");
        const modalClose = document.getElementById("close-modal");
        const modalContent = document.querySelectorAll(".modal-content");

        // Update modal
        const cancelModal = document.getElementById("cancel-modal");

        const toggleModal = () => {
            modal.classList.toggle("active");
            document.body.classList.toggle("modal-active");
            modalOverlay.classList.toggle("active");
            modalContainer.classList.toggle("active");
            modalClose.classList.toggle("active");
        }

        openModal.addEventListener("click", () => {
            toggleModal();
            document.getElementById("form").setAttribute("action", "/voitures/create")
        });

        // Update modal
        openModal2.forEach((btn) => {
            btn.addEventListener("click", () => {
                toggleModal();
                document.getElementById("form").setAttribute("action", `/voitures/${btn.getAttribute("key-custom-attribute")}`)

                console.log(btn)
                // Requête pour recupérer la voiture correspondante
                fetch(`/voitures/search/${btn.getAttribute("key-custom-attribute")}`)
                    .then(res => res.json())
                    .then(data => {
                        fillForm(...data);
                        // console.log(...data)
                    })
                    .catch(err => console.log(err.message))
            })
        })

        const fillForm = (data) => {
            console.log(data)
            document.getElementById("marque").value = data.marque;
            document.getElementById("couleur").value = data.couleur;
            document.getElementById("annee").value = data.annee;
            document.getElementById("modele").value = data.modele;
            document.getElementById("kilometrage").value = data.kilometrage;

            // document.getElementById("form").setAttribute("action", `/voitures/${openModal2.getAttribute("key-custom-attribute")}`)
        }

        // console.log(openModal2)

        // modalContent.forEach(function (btn) {
        //     btn.addEventListener("click", function () {
        //         toggleModal();
        //     });
        // });

        closeModal.forEach((btn) => {
            btn.addEventListener("click", () => {
                toggleModal();
            });
        });

        closeModal.forEach((btn) => {
            btn.addEventListener("click", () => {
                toggleModal();
            });
        });

        cancelModal.addEventListener("click", () => {
            toggleModal();
        })

        document.onkeydown = (evt) => {
            evt = evt || window.event;
            let isEscape = false;
            if ("key" in evt) {
                isEscape = (evt.key === "Escape" || evt.key === "Esc");
            } else {
                isEscape = (evt.keyCode === 27);
            }
            if (isEscape && document.body.classList.contains("modal-active")) {
                toggleModal();
            }
        };
    </script>
</body>

</html>